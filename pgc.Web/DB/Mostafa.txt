

/****** Object:  Table [Game].[Group]    Script Date: 8/10/2016 6:57:35 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [Game].[Group](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[Title] [nvarchar](500) NOT NULL,
 CONSTRAINT [PK_Group] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO





/****** Object:  Table [Game].[GamerGroup]    Script Date: 8/10/2016 7:14:39 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [Game].[GamerGroup](
	[Group_ID] [bigint] NOT NULL,
	[Gamer_ID] [bigint] NOT NULL,
 CONSTRAINT [PK_GamerGroup] PRIMARY KEY CLUSTERED 
(
	[Group_ID] ASC,
	[Gamer_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

ALTER TABLE [Game].[GamerGroup]  WITH CHECK ADD  CONSTRAINT [FK_GamerGroup_Group] FOREIGN KEY([Group_ID])
REFERENCES [Game].[Group] ([ID])
ON DELETE CASCADE
GO

ALTER TABLE [Game].[GamerGroup] CHECK CONSTRAINT [FK_GamerGroup_Group]
GO

ALTER TABLE [Game].[GamerGroup]  WITH CHECK ADD  CONSTRAINT [FK_GamerGroup_User] FOREIGN KEY([Gamer_ID])
REFERENCES [UserManagement].[User] ([ID])
ON DELETE CASCADE
GO

ALTER TABLE [Game].[GamerGroup] CHECK CONSTRAINT [FK_GamerGroup_User]
GO




/****** Object:  Table [Game].[GameOrder]    Script Date: 8/10/2016 7:16:21 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

CREATE TABLE [Game].[GameOrder](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[User_ID] [bigint] NULL,
	[Group_ID] [bigint] NULL,
	[Game_ID] [bigint] NULL,
	[OrderDate] [datetime] NOT NULL,
	[OrderPersianDate] [varchar](10) NOT NULL,
	[PayableAmount] [bigint] NOT NULL,
	[GameTitle] [nvarchar](300) NOT NULL,
	[GroupName] [nvarchar](250) NOT NULL,
	[Name] [nvarchar](250) NOT NULL,
	[Address] [nvarchar](1000) NOT NULL,
	[Tel] [nvarchar](100) NOT NULL,
	[IsPaid] [bit] NOT NULL,
	[Mobile] [nvarchar](20) NOT NULL,
 CONSTRAINT [PK_GameOrder] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [Game].[GameOrder] ADD  CONSTRAINT [DF_Table_1_Name1]  DEFAULT (N'') FOR [GroupName]
GO

ALTER TABLE [Game].[GameOrder] ADD  CONSTRAINT [DF_GameOrder_Name]  DEFAULT (N'') FOR [Name]
GO

ALTER TABLE [Game].[GameOrder] ADD  CONSTRAINT [DF_GameOrder_Mobile]  DEFAULT (N'') FOR [Mobile]
GO

ALTER TABLE [Game].[GameOrder]  WITH CHECK ADD  CONSTRAINT [FK_GameOrder_Game] FOREIGN KEY([Game_ID])
REFERENCES [Game].[Game] ([ID])
ON DELETE SET NULL
GO

ALTER TABLE [Game].[GameOrder] CHECK CONSTRAINT [FK_GameOrder_Game]
GO

ALTER TABLE [Game].[GameOrder]  WITH CHECK ADD  CONSTRAINT [FK_GameOrder_Group] FOREIGN KEY([Group_ID])
REFERENCES [Game].[Group] ([ID])
ON DELETE SET NULL
GO

ALTER TABLE [Game].[GameOrder] CHECK CONSTRAINT [FK_GameOrder_Group]
GO

ALTER TABLE [Game].[GameOrder]  WITH CHECK ADD  CONSTRAINT [FK_GameOrder_User] FOREIGN KEY([User_ID])
REFERENCES [UserManagement].[User] ([ID])
ON DELETE SET NULL
GO

ALTER TABLE [Game].[GameOrder] CHECK CONSTRAINT [FK_GameOrder_User]
GO






/****** Object:  Table [Game].[Payment]    Script Date: 8/10/2016 7:21:05 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

CREATE TABLE [Game].[Payment](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[Order_ID] [bigint] NOT NULL,
	[State] [int] NOT NULL,
	[RefNum] [nvarchar](50) NOT NULL,
	[Amount] [bigint] NOT NULL,
	[Date] [datetime] NOT NULL,
	[PersianDate] [varchar](10) NOT NULL,
	[IPAddress] [nvarchar](150) NOT NULL,
	[BankGeway_Enum] [int] NOT NULL,
 CONSTRAINT [PK_Payment] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [Game].[Payment] ADD  CONSTRAINT [DF_Payment_BankGeway_Enum]  DEFAULT ((1)) FOR [BankGeway_Enum]
GO

ALTER TABLE [Game].[Payment]  WITH CHECK ADD  CONSTRAINT [FK_Payment_GameOrder] FOREIGN KEY([Order_ID])
REFERENCES [Game].[GameOrder] ([ID])
GO

ALTER TABLE [Game].[Payment] CHECK CONSTRAINT [FK_Payment_GameOrder]
GO





INSERT [Configuration].[Option] ([ID], [OptionCategory_ID], [OptionLookup_ID], [Key], [Title], [Type], [Value], [DisplayOrder]) VALUES (156, 16, NULL, N'Mellat_TerminalId', N'شماره پايانه درگاه ملت', 2, N'1373269', 1)
GO
INSERT [Configuration].[Option] ([ID], [OptionCategory_ID], [OptionLookup_ID], [Key], [Title], [Type], [Value], [DisplayOrder]) VALUES (157, 16, NULL, N'Mellat_UserName', N'نام كاربري درگاه ملت', 2, N'irit', 2)
GO
INSERT [Configuration].[Option] ([ID], [OptionCategory_ID], [OptionLookup_ID], [Key], [Title], [Type], [Value], [DisplayOrder]) VALUES (158, 16, NULL, N'Mellat_Password', N'کلمه عبور درگاه ملت', 2, N'80349612', 3)
GO
INSERT [Configuration].[Option] ([ID], [OptionCategory_ID], [OptionLookup_ID], [Key], [Title], [Type], [Value], [DisplayOrder]) VALUES (159, 16, NULL, N'Mellat_BankURL', N'آدرس سایت برای انجام تراکنش', 2, N'https://bpm.shaparak.ir/pgwchannel/startpay.mellat', 3)
GO

INSERT [UserManagement].[UserMessage] ( [Key], [Type], [Direction], [Behaviour], [Description]) VALUES ( N'NoRefNum', 4, 2, 1, N'تراکنش فاقد رسید دیجیتالی است')
GO
INSERT [UserManagement].[UserMessage] ( [Key], [Type], [Direction], [Behaviour], [Description]) VALUES ( N'PaymentStatusChangedToNotPaid', 2, 2, 1, N'وضعیت پرداخت سفارش به پرداخت نشده تغییر یافت')
GO
INSERT [UserManagement].[UserMessage] ( [Key], [Type], [Direction], [Behaviour], [Description]) VALUES ( N'OnlinePaymentIsSuccessful', 1, 2, 1, N'مشتری گرامی، ضمن عرض تشکر عملیات پرداخت شما با موفقیت تکمیل گردید.')
GO
INSERT [UserManagement].[UserMessage] ( [Key], [Type], [Direction], [Behaviour], [Description]) VALUES ( N'BankWebServiceNoResponse', 4, 2, 1, N'هیچ پاسخی از بانک دریافت نشد. لطفا دوباره امتحان کنید.')
GO



UPDATE [Security].[PanelPage]
   SET [RouteUrl] = 'user/gamedetail/{id}'
      
 WHERE [ID]=200
GO







--------------------------------------------------------

INSERT INTO [UserManagement].[UserMessage]
           ([Key]
           ,[Type]
           ,[Direction]
           ,[Behaviour]
           ,[Description])
     VALUES
           ('DuplicateNationalCode'
           ,4
           ,2
           ,1
           ,N'این کد ملی قبلا ثبت شده است')
GO

ALTER TABLE Security.MenuItem ADD
	Active bit NOT NULL  DEFAULT 1
GO

ALTER TABLE Security.PanelPage ADD
	Active bit NOT NULL  DEFAULT 1
GO

ALTER TABLE Configuration.[Option] ADD
	Active bit NOT NULL  DEFAULT 1
GO



ALTER TABLE Game.Game ADD
	LogoPath nvarchar(350) NULL
GO










ALTER TABLE Security.MenuCategory ADD
	Active bit NOT NULL  DEFAULT 1
GO



UPDATE [Security].[MenuItem]
   SET [IsNew] = 0
GO


 




UPDATE [UserManagement].[UserMessage]
SET [Description] = REPLACE([Description], N'مستردیزی', 'Iran PGC')
where [Description] like N'%مستردیزی%'








